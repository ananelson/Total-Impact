<html>
  <head>
    <style type="text/css">
      .hll { background-color: #ffffcc }
      .c { color: #888888 } /* Comment */
      .err { color: #a61717; background-color: #e3d2d2 } /* Error */
      .k { color: #008800; font-weight: bold } /* Keyword */
      .cm { color: #888888 } /* Comment.Multiline */
      .cp { color: #cc0000; font-weight: bold } /* Comment.Preproc */
      .c1 { color: #888888 } /* Comment.Single */
      .cs { color: #cc0000; font-weight: bold; background-color: #fff0f0 } /* Comment.Special */
      .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
      .ge { font-style: italic } /* Generic.Emph */
      .gr { color: #aa0000 } /* Generic.Error */
      .gh { color: #303030 } /* Generic.Heading */
      .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
      .go { color: #888888 } /* Generic.Output */
      .gp { color: #555555 } /* Generic.Prompt */
      .gs { font-weight: bold } /* Generic.Strong */
      .gu { color: #606060 } /* Generic.Subheading */
      .gt { color: #aa0000 } /* Generic.Traceback */
      .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
      .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
      .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
      .kp { color: #008800 } /* Keyword.Pseudo */
      .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
      .kt { color: #888888; font-weight: bold } /* Keyword.Type */
      .m { color: #0000DD; font-weight: bold } /* Literal.Number */
      .s { color: #dd2200; background-color: #fff0f0 } /* Literal.String */
      .na { color: #336699 } /* Name.Attribute */
      .nb { color: #003388 } /* Name.Builtin */
      .nc { color: #bb0066; font-weight: bold } /* Name.Class */
      .no { color: #003366; font-weight: bold } /* Name.Constant */
      .nd { color: #555555 } /* Name.Decorator */
      .ne { color: #bb0066; font-weight: bold } /* Name.Exception */
      .nf { color: #0066bb; font-weight: bold } /* Name.Function */
      .nl { color: #336699; font-style: italic } /* Name.Label */
      .nn { color: #bb0066; font-weight: bold } /* Name.Namespace */
      .py { color: #336699; font-weight: bold } /* Name.Property */
      .nt { color: #bb0066; font-weight: bold } /* Name.Tag */
      .nv { color: #336699 } /* Name.Variable */
      .ow { color: #008800 } /* Operator.Word */
      .w { color: #bbbbbb } /* Text.Whitespace */
      .mf { color: #0000DD; font-weight: bold } /* Literal.Number.Float */
      .mh { color: #0000DD; font-weight: bold } /* Literal.Number.Hex */
      .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
      .mo { color: #0000DD; font-weight: bold } /* Literal.Number.Oct */
      .sb { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Backtick */
      .sc { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Char */
      .sd { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Doc */
      .s2 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Double */
      .se { color: #0044dd; background-color: #fff0f0 } /* Literal.String.Escape */
      .sh { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Heredoc */
      .si { color: #3333bb; background-color: #fff0f0 } /* Literal.String.Interpol */
      .sx { color: #22bb22; background-color: #f0fff0 } /* Literal.String.Other */
      .sr { color: #008800; background-color: #fff0ff } /* Literal.String.Regex */
      .s1 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Single */
      .ss { color: #aa6600; background-color: #fff0f0 } /* Literal.String.Symbol */
      .bp { color: #003388 } /* Name.Builtin.Pseudo */
      .vc { color: #336699 } /* Name.Variable.Class */
      .vg { color: #dd7700 } /* Name.Variable.Global */
      .vi { color: #3333bb } /* Name.Variable.Instance */
      .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
  </head>
  <body>

<h1>The Template Plugin</h1>
<h2>Introduction</h2>
<p>The template plugin is a template to use for the preparation of your own Total-Impact plugins. You should replace the text as noted in this documentation, the plugin itself, and the various test scripts. This documentation is written using Dexy which means that the documents themselves will act as a test. If you run Dexy over your local repository and you have everything setup correctly then your version of this document should make sense</p>
<p>The python plugins for Total-Impact have a simple structure with three routines. The <em>run_plugin</em> method coordinates the action of the <em>get_data</em> and <em>parse_data</em> methods. The <em>main</em> method simply handles parameter passing from the rest of the Total-Impact system.</p>
<h2>Imports</h2>
<p>The additional libraries required for this plugin are:</p>
<div class="highlight"><pre><a name="l-1"></a><span class="kn">import</span> <span class="nn">urllib2</span>
<a name="l-2"></a><span class="kn">import</span> <span class="nn">re</span>
<a name="l-3"></a><span class="kn">import</span> <span class="nn">urllib</span>
<a name="l-4"></a><span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>
</pre></div>

<h2>The data source</h2>
<p>Our plugin obtains data from the <em>data-source</em> using a <em>identifier</em> as the identifier. We are using <em>identifier</em> as the test identifier for this documentation.</p>
<div class="highlight"><pre><a name="l-1"></a><span class="n">BASE_DATA_URL</span> <span class="o">=</span> <span class="s">&quot;http://urlforyourdatasource.com/</span><span class="si">%s</span><span class="s">&quot;</span>
<a name="l-2"></a><span class="n">ID_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;REGEX-FOR-CHECK&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</pre></div>

<!-- TODO show where the test code sets the test identifier -->

<p>The data source returns a <em>page</em> in the following form when queried with our test identifer.</p>
<!-- TODO show the result of running get_data with the default identifier -->

<h2>Plugin specific methods</h2>
<h3>run_plugin</h3>
<p>In most cases this method will not need to be changed, feel free to remove this section if you haven't modified the run_plugin method</p>
<p>The run_plugin method coordinates the action of the other two core methods.  The first step is to check that the identifer is of the right type for this data source. The ID_PATTERN variable is set</p>
<!-- TODO show where the regex for the ID_PATTERN variable is set -->

<p>The method first checks that the <em>identifier</em> it has been passed matches the pattern specified</em></p>
<!-- TODO show the check for the id pattern matching -->

<p>The method then obtains the page as specified by calling the <em>get_data</em> method. If a page is correctly received it then parses it using the <em>get_stats</em> method and returns the response to Total-Impact core.</p>
<!-- TODO show rest of run_plugin method -->

<p>The form of the returned dictionary for this plugin is as follows.</p>
<!-- TODO show the result of running run_plugin with default id -->
<!-- TODO need to write script? -->

<h3>get_data</h3>
<p>In most cases this method will not need to be changed, feel free to remove this section if you haven't modified the get_data method. The only place likely to require change is the fetching of the page itself which might require encoding or some preprocessing or a more complex call</p>
<p>The get_data method first checks that an id has been passed to it and if not it returns <em>None</em>.</p>
<!-- TODO show checking of id -->

<p>The query URL is set by combining the BASE_DATA_URL with the id and an attempt is made to obtain the page. If successful the page is returned. If a 404 is received then the routine returns <em>None</em>. If there is some other error this is raised back up the request chain.</p>
<!-- TODO show the remainder of get_data method -->

<p>If functioning correctly the get_data function should return a <em>page</em> of the form shown here.</p>
<!-- TODO show the page returned - need to write script separately to do this? -->

<h3>get_stats</h3>
<p>This is the core specific method of your plugin and should be clearly documented as others will likely wish to build on it. The description for the template method is necessarily a little vague.</p>
<p>The get_stats routine receives the raw (unless you've done some upstream processing) page returned by get_data. The parsing will be specific to the specific plugin and data source.</p>
<p>The method first checks that the page has been provided and if not it returns <em>None</em>.</p>
<!-- TODO show section checking that page is available -->

<p>The actual parsing routine is wrapped in a try clause in case of parsing problems.</p>
<!-- TODO show the parsing section -->

<p>If you wish to divide up your description of the parsing component of your plugin you can easily add more sections by adding additonal ### @export markers to your code</p>
<p>The response to be sent to the total impact core is then wrapped as a Python Dictionary/JSON object and returned.</p>
<!-- TODO show the section that sets up the dictionary -->

<p>The results are returned as a dictionary in the following form:
<!-- TODO show what the method returns given the default id - need to write script? --></p>
<h3>main</h3>
<p>There should not be any need to change main. This is included only for completeness sake and can be removed if you haven't modified main within your plugin.</p>
<p>The main method accepts a command line argument from the Total-Impact core and parses the arguments. As all plugins work to obtain data based on one identifier from one data source this should only ever be called with one argument which is checked. The run_plugin method is then called and the final response returned back to the command line where it is collected.</p>
<div class="highlight"><pre><a name="l-1"></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a name="l-2"></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&quot;usage: %prog [options] filename&quot;</span><span class="p">,</span>
<a name="l-3"></a>                          <span class="n">version</span><span class="o">=</span><span class="s">&quot;%prog 1.0&quot;</span><span class="p">)</span>
<a name="l-4"></a>    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<a name="l-5"></a>
<a name="l-6"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a name="l-7"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;wrong number of arguments&quot;</span><span class="p">)</span>
<a name="l-8"></a>
<a name="l-9"></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a name="l-10"></a>
<a name="l-11"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">run_plugin</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<a name="l-12"></a>    <span class="k">return</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<a name="l-13"></a>
<a name="l-14"></a><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
<a name="l-15"></a>    <span class="n">main</span><span class="p">()</span>
</pre></div>
  </body>
</html>

